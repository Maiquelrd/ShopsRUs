[![LinkedIn][linkedin-shield]][linkedin-url]


## Acerca del proyecto

ShopsRUs es una tienda minorista existente. Quieren ofrecer descuentos a sus clientes en todas sus plataformas web / móviles. Requieren la construcción de un conjunto de API que brinden capacidades para calcular descuentos, generar los costos totales y generar las facturas para los clientes.

En la fábrica digital, actualmente tenemos una arquitectura de microservicios con servicios escritos en lenguajes y frameworks que soportan microservicios. Nos gustaría que desarrollaras un único servicio en nodejs que exponga varios endpoints REST (ver página siguiente) Puede utilizar la base de datos que desee (recomendamos utilizar Postgres) Deberá incluir un archivo README que contenga instrucciones para que podamos ejecutar la solución en nuestras máquinas.


<p align="right">(<a href="#top">Volver</a>)</p>



### Con que se trabajó



* [Node.js](https://nodejs.org/es/)
* [PostgreSQL](https://www.postgresql.org)

<p align="right">(<a href="#top">Volver</a>)</p>


## Inicialización

En esta sección explicaré como inicializar el proyecto.

### Prerequisitos

Nos aseguraremos de tener el npm en su ultima versión
  ```sh
  npm install npm@latest -g
  ```

### Instalacion

Para instalar la aplicación debermos realizar los siguientes pasos.

1. Clonaremos el repositorio
   ```sh
   git clone https://github.com/Maiquelrd/ShopsRUs
   ```
2. Instalaremos los paquetes que utiliza el proyecto
   ```sh
   npm install
   ```
3. En nuestra base de datos postgress pondremos los scripts puestos en el archivo sql/db.sql
   ```sh
   CREATE TABLE IF NOT EXISTS TiposProductos(
		TipoProductoID integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
		Nombre text,
		Descripcion text,
		FechaCreacion timestamp,
		Activo BOOLEAN
	);
    CREATE TABLE IF NOT EXISTS Productos(
    		ProductoID integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    		TipoProductoID INTEGER REFERENCES TiposProductos(TipoProductoID) ON DELETE CASCADE ON UPDATE CASCADE,
    		Nombre text,
    		Descripcion text,
    		Precio decimal,
    		FechaCreacion timestamp,
    		Activo BOOLEAN
    	);
    CREATE TABLE IF NOT EXISTS TiposClientes(
    		TipoClienteID integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    		Nombre text,
    		Descripcion text,
    		FechaCreacion timestamp,
    		Activo BOOLEAN
    	);
    CREATE TABLE IF NOT EXISTS Clientes(
    		ClienteID integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    		TipoClienteID INTEGER REFERENCES TiposClientes(TipoClienteID) ON DELETE CASCADE ON UPDATE CASCADE,
    		Nombres text,
    		Apellidos text,
    		FechaNacimiento timestamp,
    		FechaCreacion timestamp,
    		Activo BOOLEAN
    	);
    CREATE TABLE IF NOT EXISTS Facturas(
    		FacturaID integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    		ClienteID INTEGER REFERENCES Clientes(ClienteID) ON DELETE CASCADE ON UPDATE CASCADE,
    		TotalCrudo decimal,
    		TotalDescuento decimal,
    		FechaCreacion timestamp,
    		Activo BOOLEAN
    	);
    CREATE TABLE IF NOT EXISTS ProductosFacturas(
    		ProductosFacturaID integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    		FacturaID INTEGER REFERENCES Facturas(FacturaID) ON DELETE CASCADE ON UPDATE CASCADE,
    		ProductoID INTEGER REFERENCES Productos(ProductoID) ON DELETE CASCADE ON UPDATE CASCADE,
    		FechaCreacion timestamp,
    		Activo BOOLEAN
    	);
    	
    	CREATE TABLE IF NOT EXISTS Reglas(
    	ReglaID integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    	Nombre text,
    	FechaCreacion timestamp,
    	Activo BOOLEAN
    );
    
    CREATE TABLE IF NOT EXISTS Descuentos(
    	DescuentoID integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    	Nombre text,
    	Tipo text,
    	Valor decimal,
    	FechaCreacion timestamp,
    	Activo BOOLEAN
    );
    
    CREATE TABLE IF NOT EXISTS ReglasDescuentos(
    	ReglaDescuentoID integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    	DescuentoID INTEGER REFERENCES Descuentos(DescuentoID) ON DELETE CASCADE ON UPDATE CASCADE,
    	ReglaID INTEGER REFERENCES Reglas(ReglaID) ON DELETE CASCADE ON UPDATE CASCADE,
    	Criterio text,
    	FechaCreacion timestamp,
    	Activo BOOLEAN
    );
    
    CREATE TABLE IF NOT EXISTS DescuentosAplicados(
    	DescuentoAplicadoID integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    	DescuentoID INTEGER REFERENCES Descuentos(DescuentoID) ON DELETE CASCADE ON UPDATE CASCADE,
    	FacturaID INTEGER REFERENCES Facturas(FacturaID) ON DELETE CASCADE ON UPDATE CASCADE,
    	FechaCreacion timestamp,
    	Activo BOOLEAN
    );
    
    
    
    
    
    
    
    INSERT into TiposProductos (Nombre, Descripcion, FechaCreacion, Activo) VALUES (N'Comestible', N'Algo comestible', CAST(N'2021-10-30T19:47:03.390' AS timestamp), true);
    INSERT into TiposProductos (Nombre, Descripcion, FechaCreacion, Activo) VALUES (N'Electrodomestico', N'Un articulo electrico para el hogar', CAST(N'2021-10-30T19:47:03.390' AS timestamp), true);
    
    INSERT into Productos (TipoProductoID, Nombre, Descripcion, Precio, FechaCreacion, Activo) VALUES (1, N'Manzana', N'Manzana de la montaña', 59.9, CAST(N'2021-10-30T19:47:03.390' AS timestamp), true);
    INSERT into Productos (TipoProductoID, Nombre, Descripcion, Precio, FechaCreacion, Activo) VALUES (2, N'Laptop', N'PC portatil', 12000.00, CAST(N'2021-10-30T19:47:03.390' AS timestamp), true);
    
    
    INSERT into TiposClientes (Nombre, Descripcion, FechaCreacion, Activo) VALUES (N'Afiliado', N'Un afiliado de la empresa', CAST(N'2021-10-30T19:47:03.390' AS timestamp), true);
    INSERT into TiposClientes (Nombre, Descripcion, FechaCreacion, Activo) VALUES (N'Empleado', N'Un empleado de la empresa', CAST(N'2021-10-30T19:47:03.390' AS timestamp), true);
    INSERT into TiposClientes (Nombre, Descripcion, FechaCreacion, Activo) VALUES (N'Consumidor', N'Un empleado de la empresa', CAST(N'2021-10-30T19:47:03.390' AS timestamp), true);
    
    INSERT into Clientes (TipoClienteID, Nombres, Apellidos, FechaNacimiento, FechaCreacion, Activo) VALUES (1, N'Mauricio Michael', N'Mojica Nuñez', CAST(N'2000-01-03T19:47:03.390' AS timestamp), CAST(N'2021-10-30T19:47:03.390' AS timestamp) ,true);
    INSERT into Clientes (TipoClienteID, Nombres, Apellidos, FechaNacimiento, FechaCreacion, Activo) VALUES (2, N'Roberto Manuel', N'Ramirez Nuez', CAST(N'2002-06-03T19:47:03.390' AS timestamp), CAST(N'2021-10-30T19:47:03.390' AS timestamp),true);
    INSERT into Clientes (TipoClienteID, Nombres, Apellidos, FechaNacimiento, FechaCreacion, Activo) VALUES (3, N'Yosiel Carmen', N'Pandora Leico', CAST(N'2002-06-03T19:47:03.390' AS timestamp), CAST(N'2016-10-30T19:47:03.390' AS timestamp),true);
    
    INSERT into Reglas (Nombre, FechaCreacion, Activo) VALUES (N'Por tipo de cliente', CAST(N'2021-10-30T19:47:03.390' AS timestamp) ,true);
    INSERT into Reglas (Nombre, FechaCreacion, Activo) VALUES (N'Por tipo de producto', CAST(N'2021-10-30T19:47:03.390' AS timestamp) ,true);
    INSERT into Reglas (Nombre, FechaCreacion, Activo) VALUES (N'Por nombre de cliente', CAST(N'2021-10-30T19:47:03.390' AS timestamp) ,true);
    INSERT into Reglas (Nombre, FechaCreacion, Activo) VALUES (N'Por apellido de cliente', CAST(N'2021-10-30T19:47:03.390' AS timestamp) ,true);
    INSERT into Reglas (Nombre, FechaCreacion, Activo) VALUES (N'Por edad de cliente', CAST(N'2021-10-30T19:47:03.390' AS timestamp) ,true);
    INSERT into Reglas (Nombre, FechaCreacion, Activo) VALUES (N'Por tiempo en la tienda del cliente', CAST(N'2021-10-30T19:47:03.390' AS timestamp) ,true);
    INSERT into Reglas (Nombre, FechaCreacion, Activo) VALUES (N'Por cantidad total factura', CAST(N'2021-10-30T19:47:03.390' AS timestamp) ,true);
    INSERT into Reglas (Nombre, FechaCreacion, Activo) VALUES (N'Por fecha actual', CAST(N'2021-10-30T19:47:03.390' AS timestamp) ,true);
    INSERT into Reglas (Nombre, FechaCreacion, Activo) VALUES (N'Por nombre de producto', CAST(N'2021-10-30T19:47:03.390' AS timestamp) ,true);
    INSERT into Reglas (Nombre, FechaCreacion, Activo) VALUES (N'No criterio', CAST(N'2021-10-30T19:47:03.390' AS timestamp) ,true);
    
    INSERT into Descuentos (Nombre, Tipo, Valor, FechaCreacion, Activo) VALUES (N'10% por ser afiliado', N'Porcentual', 10 , CAST(N'2021-10-30T19:47:03.390' AS timestamp) ,true);
    INSERT into Descuentos (Nombre, Tipo, Valor, FechaCreacion, Activo) VALUES (N'30% por ser empleado', N'Porcentual', 30 , CAST(N'2021-10-30T19:47:03.390' AS timestamp) ,true);
    INSERT into Descuentos (Nombre, Tipo, Valor, FechaCreacion, Activo) VALUES (N'5% por ser cliente por mas de 2 años', N'Porcentual', 5 , CAST(N'2021-10-30T19:47:03.390' AS timestamp) ,true);
    INSERT into Descuentos (Nombre, Tipo, Valor, FechaCreacion, Activo) VALUES (N'5 dolares menos cada 100', N'Cada 100', 5 , CAST(N'2021-10-30T19:47:03.390' AS timestamp) ,true);
    
    
    INSERT into ReglasDescuentos (DescuentoID, ReglaID, Criterio, FechaCreacion, Activo) VALUES (1, 1, N'=|Afiliado' , CAST(N'2021-10-30T19:47:03.390' AS timestamp) ,true);
    INSERT into ReglasDescuentos (DescuentoID, ReglaID, Criterio, FechaCreacion, Activo) VALUES (2, 1, N'=|Empleado' , CAST(N'2021-10-30T19:47:03.390' AS timestamp) ,true);
    INSERT into ReglasDescuentos (DescuentoID, ReglaID, Criterio, FechaCreacion, Activo) VALUES (3, 6, N'>=|2' , CAST(N'2021-10-30T19:47:03.390' AS timestamp) ,true);
    INSERT into ReglasDescuentos (DescuentoID, ReglaID, Criterio, FechaCreacion, Activo) VALUES (4, 10, N'' , CAST(N'2021-10-30T19:47:03.390' AS timestamp) ,true);
   ```
4. Pondremos los datos de la base de datos en el archivo .env
Ejemplo:
   ```js
   PORT = 3000
	DBSERVER = "ShopsRUs"
	DBUSER = "postgres"
	DBPASSWORD = "123"
	DBHOST = "localhost"
   ```

<p align="right">(<a href="#top">Volver</a>)</p>


## Uso

Para correr la aplicación ponemos el comando:

   ```js
   npm run build --ESTO ES SOLO LA PRIMERA VEZ
   npm run start
   ```



<p align="right">(<a href="#top">Volver</a>)</p>


## ENDPOINTS Y EJEMPLOS

Estos son los endpoints en el programa

**TipoProducto**:

* **api/tipoProductos** - GET - Obtiene una lista de todos los TiposProductos
* **api/tipoProductos/{id}**- GET - Obtiene el tipo producto con ese ID.
* **api/tipoProductos/create**- POST - Crea un tipoProducto con el body.
Ejemplo:
```json
{
    "nombre": "Electrodomestico",
    "descripcion": "Un articulo electronico para el hogar"
}
```
* **api/tipoProductos/{id}**- PUT - modifica un tipoProducto con el body.
Ejemplo:
```json
{
    "nombre": "Electrodomestico",
    "descripcion": "Un articulo electronico para el hogar"
}
```
* **api/tipoproductos/{id}**- DELETE - Elimina el tipo producto con ese ID.

**Producto**:

* **api/productos**- GET - Obtiene una lista de todos los productos
* **api/productos/{id}**- GET - Obtiene el tipo producto con ese ID.
* **api/productos/create**- POST - Crea un producto con el body.
Ejemplo:
```json
{
    "tipoproductoid": 2,
    "nombre": "Manzano",
    "descripcion": "pruebaDesc",
    "precio": 51.23
}
```
* **api/productos/{id}**- PUT - modifica un producto con el body.
Ejemplo:
```json
{
    "tipoproductoid": 2,
    "nombre": "Manzano",
    "descripcion": "pruebaDesc",
    "precio": 51.23
}
```
* **api/productos/{id}**- DELETE - Elimina el tipo producto con ese ID.




<p align="right">(<a href="#top">Volver</a>)</p>


## Contacto

Mauricio Mojica - [@sirmaiquis](https://www.instagram.com/sirmaiquis/) - maiquel.mojica@gmail.com

Link del proyecto: [https://github.com/Maiquelrd/ShopsRUs)

<p align="right">(<a href="#top">Volver</a>)</p>



[linkedin-shield]: https://img.shields.io/badge/-LinkedIn-black.svg?style=for-the-badge&logo=linkedin&colorB=555
[linkedin-url]: https://www.linkedin.com/in/mauriciomojica/
[product-screenshot]: images/screenshot.png
